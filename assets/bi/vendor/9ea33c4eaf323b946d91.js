"use strict";(self.webpackChunkaesirx_analytics=self.webpackChunkaesirx_analytics||[]).push([[8307],{42217:(e,t,n)=>{var a=n(82617);t.mw={prefix:a.prefix,iconName:a.iconName,icon:[a.width,a.height,a.aliases,a.unicode,a.svgPathData]},t.SG=t.mw,a.prefix,a.iconName,a.width,a.height,a.aliases,a.unicode,a.svgPathData,a.aliases},82617:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});var n="circle-check",a=[61533,"check-circle"],s="f058",c="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM369 209L241 337c-9.4 9.4-24.6 9.4-33.9 0l-64-64c-9.4-9.4-9.4-24.6 0-33.9s24.6-9.4 33.9 0l47 47L335 175c9.4-9.4 24.6-9.4 33.9 0s9.4 24.6 0 33.9z";t.definition={prefix:"fas",iconName:n,icon:[512,512,a,s,c]},t.faCircleCheck=t.definition,t.prefix="fas",t.iconName=n,t.width=512,t.height=512,t.ligatures=a,t.unicode=s,t.svgPathData=c,t.aliases=a},50688:(e,t,n)=>{n.r(t),n.d(t,{default:()=>N});var a=n(25219),s=n(58380),c=n(9251),r=n(14835),o=n(54258),i=(n(69171),n(87698)),l=(n(24899),n(96540)),m=n(9072),d=n(27893),u=n(10159),g=n(44479),p=n(61105),w=n(67676),h=n(56109),b=n(50894),E=n(51535),f=n(49582),x=({isConnecting:e,handleOnConnect:t,activeConnectorError:n,activeConnectorType:s,activeConnector:c,noLogin:r,disabled:o})=>l.createElement(l.Fragment,null,l.createElement("div",{className:""},l.createElement(g.A,null,l.createElement(p.A,{lg:""+(r?"6":"12")},u.xl?l.createElement("button",{disabled:e||o,type:"button",className:"btn btn-dark btn-concordium fw-medium text-nowrap py-2 px-4 fs-18 lh-sm text-white d-flex align-items-center justify-content-start w-100 "+(r?"mb-3 mb-lg-0":"mb-3"),onClick:()=>t(a.p,"browser")},e?l.createElement(l.Fragment,null,l.createElement("span",{className:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"}),"Connecting"):l.createElement(l.Fragment,null,l.createElement("img",{src:a.OD,className:"me-3 align-text-bottom",alt:"Concordium",width:24}),"Concordium Browser Wallet")):u.m0?l.createElement(l.Fragment,null,l.createElement("button",{className:"btn btn-dark btn-concordium flex-grow-1 fw-medium py-2 px-4 fs-18 lh-sm text-white d-flex align-items-center justify-content-start w-100",onClick:()=>t(a.T$,"walletconnect")},n||!s||c?l.createElement(l.Fragment,null,l.createElement("div",{className:"d-flex text-start align-items-center"},l.createElement("p",{className:"mb-0 fs-18 text-nowrap pe-3 me-3 border-end text-nowrap"},"QR Code"),l.createElement("p",{className:"mb-0 fs-12"},"Concordium or CryptoX Mobile Wallets"))):l.createElement("span",{className:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"}))):l.createElement(l.Fragment,null)))),u.Fr&&u.m0&&l.createElement("div",{className:"bg-success-light p-3 mt-3 fs-14 text-start"},l.createElement("p",{className:"mb-1 fw-bold"},"Note for Concordium Wallet:"),l.createElement("p",{className:"mb-0"},"Please connect & sign your signature on the app then switch back to the browser to continue"))),C=({account:e,connection:t,setIsAccountExist:n,setExpand:g,setAccountInfo:p,noSignUpForm:E})=>{const[f,x]=(0,l.useState)(""),[C,y]=(0,l.useState)(!0),[N,v]=(0,l.useState)(!1),[k,A]=(0,l.useState)(!1),[S,F]=(0,l.useState)(!1),I="concordium",{noCreateAccount:R,isSignUpForm:P,handleOnData:W,toggle:L,isRequireEmail:T}=(0,l.useContext)(r.k),{getWalletNonce:U,verifySignature:_}=(0,s.P)(I,e),O=async()=>{A(!0);try{const t=await(0,i.s5)(e??""),n=await(0,i.gL)(),a=await(0,w.Cr)(),s=new h.lB(a.grpcTransport),c=b.n3(e),r=await s.getAccountInfo(c),o=r?.accountCredentials[0]?.value?.contents?.commitments?.cmmAttributes?.nationality,l=r?.accountCredentials[0]?.value?.contents?.commitments?.cmmAttributes?.countryOfResidence;o||(n[0].attributeTag=l?"countryOfResidence":"idDocIssuer");const m=await a.requestIdProof(e??"",n,t);return await(0,i.Gr)(t,m)&&(v(!0),A(!1)),!0}catch(e){return v(!1),A(!1),!1}};return l.createElement(l.Fragment,null,S&&!E?l.createElement(l.Fragment,null,l.createElement("div",{className:"text-start"},l.createElement("div",{className:"cursor-pointer fw-medium fs-14 d-inline-flex align-items-center back-button text-primary",onClick:()=>{F(!1),g("wallet"),n({status:!0,type:""})}},l.createElement("img",{src:o.w,alt:"Back Icon",className:"me-1"}),"Back")),l.createElement("div",{className:"text-primary"},l.createElement(c.Y,{setShow:P?L:async()=>{F(!1),g("wallet"),n({status:!0,type:""})},setIsExist:y,setIsAccountExist:n,accountAddress:e,connection:t,wallet:"concordium",isRequireEmail:T}))):l.createElement(l.Fragment,null,l.createElement("button",{disabled:""!==f||k,type:"button",className:"btn btn-dark btn-concordium w-100 fw-medium py-2 px-4 fs-18 lh-sm text-white d-flex align-items-center text-start",onClick:()=>{!C||P?(async()=>{x("loading");try{const t=await(0,i.NO)(e,I);t?.data?.result?m.oR.error("You've already created an account with this wallet."):(N||u.Fr&&u.m0||await O())&&(F(!0),g("wallet-concordium")),x("")}catch(e){console.log(e),x(""),m.oR.error(e?.response?.data?.error||e?.message)}})():(async()=>{x("connect");const a=await U();if(a)try{x("sign");const n=await t.signMessage(e,(0,d.BB)(`${a}`)),s="object"==typeof n&&null!==n?n:JSON.parse(n);if(n){const t=await _(I,e,s);if(T){const e=await(0,i.Xf)(t?.access_token);!e?.email||/@aesirx\.io$/.test(e?.email)&&(e?.wallet_concordium&&e?.email?.includes(e?.wallet_concordium)||e?.wallet_metamask&&e?.email?.includes(e?.wallet_metamask))?(g("require-email"),p({data:t,memberId:e?.member_id})):W({...t,loginType:"concordium"})}else W({...t,loginType:"concordium"})}}catch(e){(0,m.oR)(e.message)}else!R&&y(!1),n({status:!1,type:"concordium"});x("")})()}},f?l.createElement("div",{className:"d-flex align-items-center"},l.createElement("span",{className:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"}),l.createElement("span",{className:"ms-1"},"sign"===f?"Please sign message on the wallet":"loading"===f?"Connecting...":"Please wait to connect...")):!C||P?l.createElement(l.Fragment,null,l.createElement("img",{src:a.OD,className:"me-3 align-text-bottom",alt:"Concordium logo",width:24}),k?l.createElement(l.Fragment,null,l.createElement("span",{className:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"}),l.createElement("span",{className:"ms-1"},N?"Loading...":"Authorizing")):l.createElement(l.Fragment,null,"Create account via Concordium (",e&&(0,i.l1)(e),")")):l.createElement(l.Fragment,null,l.createElement("img",{src:a.OD,className:"me-3 align-text-bottom",alt:"Concordium logo",width:24}),"Sign in via Concordium (",e&&(0,i.l1)(e),")"))))},y=e=>{const{activeConnectorType:t,activeConnector:n,activeConnectorError:a,network:c,connectedAccounts:r,genesisHashes:o,setActiveConnectorType:u,setIsAccountExist:g,setExpand:p,setAccountInfo:w,noLogin:h,setAccountAddress:b,setConnectionProvider:y,setWalletType:N,noSignUpForm:v,setWalletState:k,disabled:A}=e,{connection:S,setConnection:F,account:I,genesisHash:R}=(0,d.w5)(r,o),{connect:P,connectError:W,isConnecting:L}=(0,d.eF)(n,F),[T,U]=(0,l.useState)(),[_,O]=(0,l.useState)(""),D=(0,d.Di)(c);(0,l.useEffect)((()=>{D&&(U(void 0),D.getConsensusStatus().then((e=>e.genesisBlock)).then((e=>{const{network:t}=(0,i.NR)();let n=!1;if("testnet"===t)n=f.U5(e)===d.eU.genesisHash;else n=f.U5(e)===d.pF.genesisHash;if(!n){const{network:e}=(0,i.NR)();throw new Error(`Please change the network to ${e} in Wallet`)}U(e),O("")})).catch((e=>{U(void 0),(0,m.oR)(e.message),O(e.message)})))}),[D]),(0,l.useEffect)((()=>{n&&P()}),[n]),(0,l.useEffect)((()=>{b&&(I&&S?(b(I),y(S),N("concordium")):(b(""),y(null),N(""))),k&&I&&S&&k({wallet:"concordium",accountAddress:I,connection:S})}),[I,S]),(0,l.useEffect)((()=>{W&&"A listener indicated an asynchronous response by returning true, but the message channel closed before a response was received"!==W&&(0,m.oR)(W)}),[W]);return l.createElement(l.Fragment,null,!I||_?l.createElement(x,{isConnecting:L,handleOnConnect:async(e,t)=>{E.A.setItem("concordium",t),await u(e)},activeConnectorError:a,activeConnectorType:t,activeConnector:n,noLogin:h,disabled:A}):l.createElement(l.Fragment,null,T?h?l.createElement(s.l,{className:"mb-12px",title:"Account Connected:",value:(0,i.l1)(I,20,5),contentCopy:I}):l.createElement(C,{account:I,connection:S,setIsAccountExist:g,setExpand:p,setAccountInfo:w,noSignUpForm:v,setWalletState:k}):l.createElement("button",{className:"btn btn-dark"},l.createElement("span",{className:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"}))),a&&l.createElement("div",{className:"mt-1 fs-7 text-danger text-start"},"Connector error: ",a,"."),_&&l.createElement("div",{className:"mt-1 fs-7 text-danger text-start"},"RPC error: ",_))},N=({setIsAccountExist:e,setExpand:t,setAccountInfo:n,noLogin:a,setAccountAddress:s,setConnection:c,setWalletType:r,noSignUpForm:o=!1,setWalletState:m,disabled:u})=>{const{network:g}=(0,i.NR)();return l.createElement(d.DI,{network:"testnet"===g?d.eU:d.pF},(i=>l.createElement(y,{...i,setIsAccountExist:e,setExpand:t,setAccountInfo:n,noLogin:a,setAccountAddress:s,setConnectionProvider:c,setWalletType:r,noSignUpForm:o,setWalletState:m,disabled:u})))}},58380:(e,t,n)=>{n.d(t,{P:()=>d,l:()=>m});var a=n(69171),s=n(87698),c=n(42217),r=n(20982),o=n(96540),i=n(9072),l=n(71083),m=({title:e,value:t,className:n,contentCopy:s})=>o.createElement("div",{className:`custom_tags border text-dark rounded-1 mb-0 py-1 px-20px d-flex justify-content-between fw-semibold ${n}`},o.createElement("span",{className:"d-flex align-items-center"},o.createElement(r.g,{icon:c.SG,width:16,height:16,className:"text-success me-1"}),e),o.createElement("p",{className:"mb-0"},t," ",s&&o.createElement(a.C,{content:s,isBlack:!0,className:"bg-transparent border-0 text-dark px-1"}))),d=(e,t)=>{const{endpoint:n}=(0,s.NR)();return{getWalletNonce:async()=>{try{const a={method:"post",url:`${n}/index.php?webserviceClient=site&webserviceVersion=1.0.0&option=member&task=getWalletNonce&api=hal`,headers:{"Content-Type":"application/json"},data:{publicAddress:t,wallet:e,text:"Login with nonce: {}"}},{data:s}=await(0,l.A)(a);if(s.result)return s.result;throw!1}catch(e){return!1}},verifySignature:async(e,t,a)=>{try{const s=new URLSearchParams(window.location.search)?.get("return"),c=new URLSearchParams(window.location.search)?.get("channel_type"),r=new URLSearchParams(window.location.search)?.get("organisationId"),o={wallet:e,publicAddress:t,signature:a,...c&&{channel_type:c},...s&&{return:s},...r&&{organisationId:r}},i={method:"post",url:`${n}/index.php?webserviceClient=site&webserviceVersion=1.0.0&option=member&task=walletLogin&api=hal&return=${s??null}`,headers:{"Content-Type":"application/json"},data:o},{data:m}=await(0,l.A)(i);if(m?.result)return m?.result;throw!1}catch(e){return console.log(e),(0,i.oR)("Wrong authentication",{closeOnClick:!1}),!1}}}}}}]);